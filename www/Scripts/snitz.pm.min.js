function updateCount(){$.ajax({url:window.SnitzVars.baseUrl+"PrivateMessage/MailboxLimitString",error:function(n){alert("Update count error: "+n.responseText)},success:function(n){$("#mailbox-size").html(n)}})}var PmSentOK=function(n){updateCount();var t=window.BootstrapDialog.show({type:window.BootstrapDialog.TYPE_PRIMARY,title:"Private Messaging",message:n.param2});setTimeout(function(){t.close();window.location.replace(n.param3)},1500)},PmSendFail=function(n){$(".pm-send").show();$("body").one("click",".pm-send",bindpmsend);$("#message-box").html(n.responseText)},PmDeleteOK=function(){updateCount();var n=window.BootstrapDialog.show({type:window.BootstrapDialog.TYPE_PRIMARY,title:"Private Messaging",message:"Message deleted"});setTimeout(function(){n.close()},1500)};bindpmsend=function(n){if(n.preventDefault(),window.showDelete=!0,$("#message-form").valid()&&!$(this).attr("disabled"))$(this).attr("disabled","disabled"),$(".pm-send").hide(),window.console&&console.log("post-PM"),$("#message-form").submit();else{$(this).removeAttr("disabled");$("body").unbind("click",".pm-send",bindpmsend);$("body").one("click",".pm-send",bindpmsend)}};bindpmdraft=function(n){if(n.preventDefault(),window.showDelete=!0,$("#message-form").valid()&&!$(this).attr("disabled"))$(this).attr("disabled","disabled"),$(".pm-draft").hide(),$("#message-form").submit();else{$(this).removeAttr("disabled");$("body").unbind("click",".pm-send",bindpmsend);$("body").one("click",".pm-send",bindpmsend)}};$(window).on("load",function(){$("body").on("change","#checkAll",function(){var n=$(this).closest("form").find(":checkbox");$(this).is(":checked")?n.prop("checked",!0):n.prop("checked",!1)});$("#message-panel").hide();var n=$("#msgloading").hide();$(document).ajaxStart(function(){window.loading||n.show();window.loading=!0}).ajaxStop(function(){n.hide();window.loading=!1});$("#message-box").on("click",".getMessage",function(n){window.loading=!0;var t=$(n.target).closest("td");if($(t).text()==="")return!0;if($(".getMessage").removeClass("selected"),$(this).addClass("selected"),$("#message-panel").load(window.SnitzVars.baseUrl+"PrivateMessage/GetMessage/"+$(this).attr("data-val")+"?inbox="+$(this).attr("data-inbox")),$("#message-panel").show(),$("body").unbind("click",".pm-send",bindpmsend),$(this).attr("data-read")==="-1"){$(".pm-send").show();$("body").one("click",".pm-send",bindpmsend);$(".pm-attach").show();window.showDelete=!1}if($(this).attr("data-read")==="0"){$(".pm-send").show();$("body").one("click",".pm-send",bindpmsend);$(".pm-attach").show();window.showDelete=!1}try{$("html, body").animate({scrollTop:$("#page-top").offset().top+"px"},500,"swing")}catch(n){}});$("body").on("mouseup",".msg-selectall",function(){var n=$(this).closest("form").find(":checkbox");$(this).is(":checked")?n.prop("checked",!0):n.prop("checked",!1)});$("body").on("change",".msg-draft",function(){if(this.checked){$(".pm-send").hide();$(".pm-draft").show();$("body").one("click",".pm-draft",bindpmdraft)}else{$(".pm-send").show();$(".pm-draft").hide();$("body").one("click",".pm-send",bindpmsend)}});$("body").on("click",".pm-delete",function(n){if(n.preventDefault(),$("#del-message-form input:checkbox:checked").length===0)return window.BootstrapDialog.alert({title:window.Snitzres.Warning,message:window.Snitzres.PMNoSelection}),!1;window.BootstrapDialog.confirm({title:window.Snitzres.DeletePM,message:window.Snitzres.PMDelConfirm,callback:function(n){n&&$("#del-message-form").submit()}})});$("body").on("click",".pm-button",function(n){if(n.preventDefault(),$(this).tooltip("hide"),$("#message-panel").empty(),$("#message-panel").hide(),$("body").unbind("click",".pm-send",bindpmsend),$(this).attr("data-target")==="NewMessage"){$(".pm-send").show();$("body").unbind("click",".pm-send",bindpmsend);$("body").one("click",".pm-send",bindpmsend);$(".pm-attach").show();window.showDelete=!1}else if($(this).attr("data-target")==="ReplyMessage"){$(".pm-send").show();$("body").unbind("click",".pm-send",bindpmsend);$("body").one("click",".pm-send",bindpmsend);$(".pm-attach").show();window.showDelete=!1}else if($(this).attr("data-target")==="ForwardMessage"){$(".pm-send").show();$("body").unbind("click",".pm-send",bindpmsend);$("body").one("click",".pm-send",bindpmsend);$(".pm-attach").show();window.showDelete=!1}else $(this).attr("data-target")==="Settings"?($(".pm-send").hide(),$("body").unbind("click",".pm-send",bindpmsend),$(".pm-attach").hide(),window.showDelete=!1,$("#message-panel").load(window.SnitzVars.baseUrl+"PrivateMessage/Blocklist/"+$(this).attr("data-val")),$("#message-panel").show()):$(this).attr("data-target")==="GetFolder"?(window.showDelete=!0,$(".pm-send").hide(),$("body").unbind("click",".pm-send",bindpmsend),$(".pm-attach").hide()):$(this).attr("data-target")==="SearchMessages"?($(".pm-send").hide(),$("body").unbind("click",".pm-send",bindpmsend),$(".pm-attach").hide(),window.showDelete=!1,$("#message-panel").html(""),$("#message-panel").show()):($(".pm-send").hide(),$("body").unbind("click",".pm-send",bindpmsend),$(".pm-attach").hide());$("#message-box").load(window.SnitzVars.baseUrl+"PrivateMessage/"+$(this).attr("data-target")+"/"+$(this).attr("data-val"))});$(".yesno-checkbox").bootstrapSwitch();showDelete?$(".pm-delete").show():($(".checkbox").hide(),$(".pm-delete").hide())});